{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { PureComponent, createElement, createRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { normalizeStyle } from '../utils/style-utils';\nimport WebMercatorViewport from 'viewport-mercator-project';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport Mapbox from '../mapbox/mapbox';\nimport mapboxgl from '../utils/mapboxgl';\nimport { checkVisibilityConstraints } from '../utils/map-constraints';\nimport { MAPBOX_LIMITS } from '../utils/map-state';\nimport MapContext from './map-context';\nvar TOKEN_DOC_URL = 'https://uber.github.io/react-map-gl/#/Documentation/getting-started/about-mapbox-tokens';\nvar NO_TOKEN_WARNING = 'A valid API access token is required to use Mapbox data';\n\nfunction noop() {}\n\nvar UNAUTHORIZED_ERROR_CODE = 401;\nvar CONTAINER_STYLE = {\n  position: 'absolute',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nvar propTypes = Object.assign({}, Mapbox.propTypes, {\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  onResize: PropTypes.func,\n  preventStyleDiffing: PropTypes.bool,\n  disableTokenWarning: PropTypes.bool,\n  visible: PropTypes.bool,\n  className: PropTypes.string,\n  style: PropTypes.object,\n  visibilityConstraints: PropTypes.object\n});\nvar defaultProps = Object.assign({}, Mapbox.defaultProps, {\n  preventStyleDiffing: false,\n  disableTokenWarning: false,\n  visible: true,\n  onResize: noop,\n  className: '',\n  style: null,\n  visibilityConstraints: MAPBOX_LIMITS\n});\n\nvar StaticMap = function (_PureComponent) {\n  _inherits(StaticMap, _PureComponent);\n\n  function StaticMap() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, StaticMap);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(StaticMap)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      accessTokenInvalid: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_mapbox\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"_map\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"_mapboxMapRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"_mapContainerRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"_queryParams\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"_width\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_height\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"getMap\", function () {\n      return _this._map;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryRenderedFeatures\", function (geometry) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return _this._map.queryRenderedFeatures(geometry, options);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_mapboxMapError\", function (evt) {\n      var statusCode = evt.error && evt.error.status || evt.status;\n\n      if (statusCode === UNAUTHORIZED_ERROR_CODE && !_this.state.accessTokenInvalid) {\n        console.error(NO_TOKEN_WARNING);\n\n        _this.setState({\n          accessTokenInvalid: true\n        });\n      }\n\n      _this.props.onError(evt);\n    });\n\n    return _this;\n  }\n\n  _createClass(StaticMap, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!StaticMap.supported()) {\n        return;\n      }\n\n      var mapStyle = this.props.mapStyle;\n      this._mapbox = new Mapbox(Object.assign({}, this.props, {\n        mapboxgl: mapboxgl,\n        width: this._width,\n        height: this._height,\n        container: this._mapboxMapRef.current,\n        onError: this._mapboxMapError,\n        mapStyle: normalizeStyle(mapStyle)\n      }));\n      this._map = this._mapbox.getMap();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this._mapbox) {\n        this._updateMapStyle(prevProps, this.props);\n\n        this._updateMapProps(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this._mapbox) {\n        this._mapbox.finalize();\n\n        this._mapbox = null;\n        this._map = null;\n      }\n    }\n  }, {\n    key: \"_updateMapSize\",\n    value: function _updateMapSize(width, height) {\n      if (this._width !== width || this._height !== height) {\n        this._width = width;\n        this._height = height;\n\n        this._updateMapProps(this.props);\n      }\n    }\n  }, {\n    key: \"_updateMapStyle\",\n    value: function _updateMapStyle(oldProps, newProps) {\n      var mapStyle = newProps.mapStyle;\n      var oldMapStyle = oldProps.mapStyle;\n\n      if (mapStyle !== oldMapStyle) {\n        this._map.setStyle(normalizeStyle(mapStyle), {\n          diff: !this.props.preventStyleDiffing\n        });\n      }\n    }\n  }, {\n    key: \"_updateMapProps\",\n    value: function _updateMapProps(props) {\n      if (!this._mapbox) {\n        return;\n      }\n\n      this._mapbox.setProps(Object.assign({}, props, {\n        width: this._width,\n        height: this._height\n      }));\n    }\n  }, {\n    key: \"_renderNoTokenWarning\",\n    value: function _renderNoTokenWarning() {\n      if (this.state.accessTokenInvalid && !this.props.disableTokenWarning) {\n        var style = {\n          position: 'absolute',\n          left: 0,\n          top: 0\n        };\n        return createElement('div', {\n          key: 'warning',\n          id: 'no-token-warning',\n          style: style\n        }, [createElement('h3', {\n          key: 'header'\n        }, NO_TOKEN_WARNING), createElement('div', {\n          key: 'text'\n        }, 'For information on setting up your basemap, read'), createElement('a', {\n          key: 'link',\n          href: TOKEN_DOC_URL\n        }, 'Note on Map Tokens')]);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"_renderOverlays\",\n    value: function _renderOverlays(dimensions) {\n      var _this2 = this;\n\n      var _dimensions$width = dimensions.width,\n          width = _dimensions$width === void 0 ? Number(this.props.width) : _dimensions$width,\n          _dimensions$height = dimensions.height,\n          height = _dimensions$height === void 0 ? Number(this.props.height) : _dimensions$height;\n\n      this._updateMapSize(width, height);\n\n      return createElement(MapContext.Consumer, null, function (interactiveContext) {\n        var context = Object.assign({}, interactiveContext, {\n          viewport: new WebMercatorViewport(Object.assign({}, _this2.props, _this2.props.viewState, {\n            width: width,\n            height: height\n          })),\n          map: _this2._map,\n          mapContainer: interactiveContext.mapContainer || _this2._mapContainerRef.current\n        });\n        return createElement(MapContext.Provider, {\n          value: context\n        }, createElement('div', {\n          key: 'map-overlays',\n          className: 'overlays',\n          style: CONTAINER_STYLE,\n          children: _this2.props.children\n        }));\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          className = _this$props.className,\n          width = _this$props.width,\n          height = _this$props.height,\n          style = _this$props.style,\n          visibilityConstraints = _this$props.visibilityConstraints;\n      var mapContainerStyle = Object.assign({\n        position: 'relative'\n      }, style, {\n        width: width,\n        height: height\n      });\n      var visible = this.props.visible && checkVisibilityConstraints(this.props.viewState || this.props, visibilityConstraints);\n      var mapStyle = Object.assign({}, CONTAINER_STYLE, {\n        visibility: visible ? 'inherit' : 'hidden'\n      });\n      return createElement('div', {\n        key: 'map-container',\n        style: mapContainerStyle,\n        ref: this._mapContainerRef,\n        children: [createElement('div', {\n          key: 'map-mapbox',\n          ref: this._mapboxMapRef,\n          style: mapStyle,\n          className: className\n        }), createElement(AutoSizer, {\n          key: 'autosizer',\n          disableWidth: Number.isFinite(width),\n          disableHeight: Number.isFinite(height),\n          onResize: this.props.onResize\n        }, this._renderOverlays.bind(this)), this._renderNoTokenWarning()]\n      });\n    }\n  }], [{\n    key: \"supported\",\n    value: function supported() {\n      return mapboxgl && mapboxgl.supported();\n    }\n  }]);\n\n  return StaticMap;\n}(PureComponent);\n\n_defineProperty(StaticMap, \"propTypes\", propTypes);\n\n_defineProperty(StaticMap, \"defaultProps\", defaultProps);\n\nexport { StaticMap as default };","map":{"version":3,"sources":["../../../src/components/static-map.js"],"names":["TOKEN_DOC_URL","NO_TOKEN_WARNING","UNAUTHORIZED_ERROR_CODE","CONTAINER_STYLE","position","width","height","overflow","propTypes","Mapbox","PropTypes","onResize","preventStyleDiffing","disableTokenWarning","visible","className","style","visibilityConstraints","object","defaultProps","MAPBOX_LIMITS","StaticMap","PureComponent","mapboxgl","accessTokenInvalid","mapStyle","container","onError","normalizeStyle","prevProps","createRef","options","oldProps","newProps","oldMapStyle","diff","props","_height","statusCode","evt","console","left","top","createElement","key","id","href","dimensions","Number","MapContext","context","viewport","map","mapContainer","interactiveContext","current","value","children","mapContainerStyle","checkVisibilityConstraints","visibility","ref","disableWidth","disableHeight"],"mappings":"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","sourcesContent":["// @flow\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {PureComponent, createElement, createRef} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {normalizeStyle} from '../utils/style-utils';\n\nimport WebMercatorViewport from 'viewport-mercator-project';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport Mapbox from '../mapbox/mapbox';\nimport mapboxgl from '../utils/mapboxgl';\nimport {checkVisibilityConstraints} from '../utils/map-constraints';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport MapContext from './map-context';\n\nimport type {ViewState} from '../mapbox/mapbox';\n\n/* eslint-disable max-len */\nconst TOKEN_DOC_URL =\n  'https://uber.github.io/react-map-gl/#/Documentation/getting-started/about-mapbox-tokens';\nconst NO_TOKEN_WARNING = 'A valid API access token is required to use Mapbox data';\n/* eslint-disable max-len */\n\nfunction noop() {}\n\nconst UNAUTHORIZED_ERROR_CODE = 401;\n\nconst CONTAINER_STYLE = {\n  position: 'absolute',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nconst propTypes = Object.assign({}, Mapbox.propTypes, {\n  /** The dimensions of the map **/\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\n  /** Callback when map size changes **/\n  onResize: PropTypes.func,\n  /** There are known issues with style diffing. As stopgap, add option to prevent style diffing. */\n  preventStyleDiffing: PropTypes.bool,\n  /** Hide invalid token warning even if request fails */\n  disableTokenWarning: PropTypes.bool,\n  /** Whether the map is visible */\n  visible: PropTypes.bool,\n  /** Custom class name for the map */\n  className: PropTypes.string,\n  /** Custom CSS for the container */\n  style: PropTypes.object,\n\n  /** Advanced features */\n  // Contraints for displaying the map. If not met, then the map is hidden.\n  // Experimental! May be changed in minor version updates.\n  visibilityConstraints: PropTypes.object\n});\n\nconst defaultProps = Object.assign({}, Mapbox.defaultProps, {\n  preventStyleDiffing: false,\n  disableTokenWarning: false,\n  visible: true,\n  onResize: noop,\n  className: '',\n  style: null,\n  visibilityConstraints: MAPBOX_LIMITS\n});\n\nexport type StaticMapProps = {\n  gl?: any,\n  width: number | string,\n  height: number | string,\n  preventStyleDiffing: boolean,\n  disableTokenWarning: boolean,\n  visible: boolean,\n  className: string,\n  style: any,\n  visibilityConstraints: any,\n  children?: any,\n  onLoad: Function,\n  onError: Function,\n  onResize: Function,\n  mapStyle: any,\n  visible: boolean,\n  viewState?: ViewState,\n  longitude: number,\n  latitude: number,\n  zoom: number,\n  bearing: number,\n  pitch: number,\n  altitude?: number\n};\n\ntype State = {\n  accessTokenInvalid: boolean\n};\n\nexport default class StaticMap extends PureComponent<StaticMapProps, State> {\n  static supported() {\n    return mapboxgl && mapboxgl.supported();\n  }\n\n  static propTypes: any = propTypes;\n  static defaultProps: StaticMapProps = defaultProps;\n\n  state: State = {\n    accessTokenInvalid: false\n  };\n\n  componentDidMount() {\n    if (!StaticMap.supported()) {\n      return;\n    }\n    const {mapStyle} = this.props;\n\n    this._mapbox = new Mapbox(\n      // $FlowFixMe\n      Object.assign({}, this.props, {\n        mapboxgl, // Handle to mapbox-gl library\n        width: this._width,\n        height: this._height,\n        container: this._mapboxMapRef.current,\n        onError: this._mapboxMapError,\n        mapStyle: normalizeStyle(mapStyle)\n      })\n    );\n    this._map = this._mapbox.getMap();\n  }\n\n  componentDidUpdate(prevProps: StaticMapProps) {\n    if (this._mapbox) {\n      this._updateMapStyle(prevProps, this.props);\n      this._updateMapProps(this.props);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._mapbox) {\n      this._mapbox.finalize();\n      this._mapbox = null;\n      this._map = null;\n    }\n  }\n\n  _mapbox: any = null;\n  _map: any = null;\n  _mapboxMapRef: {current: null | HTMLDivElement} = createRef();\n  _mapContainerRef: {current: null | HTMLDivElement} = createRef();\n  _queryParams: any = {};\n  _width: number = 0;\n  _height: number = 0;\n\n  // External apps can access map this way\n  getMap = () => {\n    return this._map;\n  };\n\n  /** Uses Mapbox's\n   * queryRenderedFeatures API to find features at point or in a bounding box.\n   * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n   * To query only some of the layers, set the `interactive` property in the\n   * layer style to `true`.\n   * @param {[Number, Number]|[[Number, Number], [Number, Number]]} geometry -\n   *   Point or an array of two points defining the bounding box\n   * @param {Object} options - query options\n   */\n  queryRenderedFeatures = (geometry: any, options: any = {}) => {\n    return this._map.queryRenderedFeatures(geometry, options);\n  };\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(width: number, height: number) {\n    if (this._width !== width || this._height !== height) {\n      this._width = width;\n      this._height = height;\n      this._updateMapProps(this.props);\n    }\n  }\n\n  _updateMapStyle(oldProps: StaticMapProps, newProps: StaticMapProps) {\n    const mapStyle = newProps.mapStyle;\n    const oldMapStyle = oldProps.mapStyle;\n    if (mapStyle !== oldMapStyle) {\n      this._map.setStyle(normalizeStyle(mapStyle), {\n        diff: !this.props.preventStyleDiffing\n      });\n    }\n  }\n\n  _updateMapProps(props: StaticMapProps) {\n    if (!this._mapbox) {\n      return;\n    }\n    this._mapbox.setProps(\n      Object.assign({}, props, {\n        width: this._width,\n        height: this._height\n      })\n    );\n  }\n\n  // Handle map error\n  _mapboxMapError = (evt: {\n    error?: {\n      message: string,\n      status: number\n    },\n    status: number\n  }) => {\n    const statusCode = (evt.error && evt.error.status) || evt.status;\n    if (statusCode === UNAUTHORIZED_ERROR_CODE && !this.state.accessTokenInvalid) {\n      // Mapbox throws unauthorized error - invalid token\n      console.error(NO_TOKEN_WARNING); // eslint-disable-line\n      this.setState({accessTokenInvalid: true});\n    }\n    this.props.onError(evt);\n  };\n\n  _renderNoTokenWarning() {\n    if (this.state.accessTokenInvalid && !this.props.disableTokenWarning) {\n      const style = {\n        position: 'absolute',\n        left: 0,\n        top: 0\n      };\n      return createElement('div', {key: 'warning', id: 'no-token-warning', style}, [\n        createElement('h3', {key: 'header'}, NO_TOKEN_WARNING),\n        createElement('div', {key: 'text'}, 'For information on setting up your basemap, read'),\n        createElement('a', {key: 'link', href: TOKEN_DOC_URL}, 'Note on Map Tokens')\n      ]);\n    }\n\n    return null;\n  }\n\n  _renderOverlays(dimensions: {width?: number, height?: number}) {\n    const {width = Number(this.props.width), height = Number(this.props.height)} = dimensions;\n    this._updateMapSize(width, height);\n\n    return createElement(MapContext.Consumer, null, interactiveContext => {\n      const context = Object.assign({}, interactiveContext, {\n        viewport: new WebMercatorViewport(\n          // $FlowFixMe\n          Object.assign({}, this.props, this.props.viewState, {\n            width,\n            height\n          })\n        ),\n        map: this._map,\n        mapContainer: interactiveContext.mapContainer || this._mapContainerRef.current\n      });\n\n      return createElement(\n        MapContext.Provider,\n        {value: context},\n        createElement('div', {\n          key: 'map-overlays',\n          className: 'overlays',\n          style: CONTAINER_STYLE,\n          children: this.props.children\n        })\n      );\n    });\n  }\n\n  render() {\n    const {className, width, height, style, visibilityConstraints} = this.props;\n    const mapContainerStyle = Object.assign({position: 'relative'}, style, {\n      width,\n      height\n    });\n\n    const visible =\n      this.props.visible &&\n      checkVisibilityConstraints(this.props.viewState || this.props, visibilityConstraints);\n\n    const mapStyle = Object.assign({}, CONTAINER_STYLE, {\n      visibility: visible ? 'inherit' : 'hidden'\n    });\n\n    return createElement('div', {\n      key: 'map-container',\n      style: mapContainerStyle,\n      ref: this._mapContainerRef,\n      children: [\n        createElement('div', {\n          key: 'map-mapbox',\n          ref: this._mapboxMapRef,\n          style: mapStyle,\n          className\n        }),\n        // AutoSizer is a pure component and does not rerender when map props change\n        // rebind the callback so that it's triggered every render pass\n        createElement(\n          AutoSizer,\n          {\n            key: 'autosizer',\n            disableWidth: Number.isFinite(width),\n            disableHeight: Number.isFinite(height),\n            onResize: this.props.onResize\n          },\n          this._renderOverlays.bind(this)\n        ),\n        this._renderNoTokenWarning()\n      ]\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}